<!DOCTYPE html>
<html lang="th">
<head>
┬а ┬а <meta charset="UTF-8">
┬а ┬а <meta name="viewport" content="width=device-width, initial-scale=1.0">
┬а ┬а <title>р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕гр╕▓р╕Зр╕зр╕▒р╕е</title>
┬а ┬а <link rel="stylesheet" href="reward.css"> 
┬а ┬а <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
┬а ┬а <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

┬а ┬а <script>
┬а ┬а ┬а ┬а // NOTE: р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ Dark Mode р╕Цр╕╣р╕Бр╣Ар╕гр╕╡р╕вр╕Бр╣Гр╕Щ <head>
┬а ┬а ┬а ┬а function toggleTheme(theme) {
┬а ┬а ┬а ┬а ┬а ┬а const body = document.body;
┬а ┬а ┬а ┬а ┬а ┬а body.classList.remove('light-mode', 'dark-mode'); 
┬а ┬а ┬а ┬а ┬а ┬а if (theme === 'dark') {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а body.classList.add('dark-mode');
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а function loadTheme() {
┬а ┬а ┬а ┬а ┬а ┬а // р╣Гр╕Кр╣Йр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ър╕Ыр╕Пр╕┤р╕Ър╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕лр╕▓р╕Бр╣Др╕бр╣Ир╕бр╕╡р╣Гр╕Щ localStorage
┬а ┬а ┬а ┬а ┬а ┬а const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
┬а ┬а ┬а ┬а ┬а ┬а const defaultTheme = prefersDark ? 'dark' : 'light';
┬а ┬а ┬а ┬а ┬а ┬а const savedTheme = localStorage.getItem('theme') || defaultTheme; 
┬а ┬а ┬а ┬а ┬а ┬а toggleTheme(savedTheme);
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а loadTheme(); 
┬а ┬а </script>
</head>
<body>

<div class="sidebar">
┬а ┬а <div class="logo">
┬а ┬а ┬а ┬а <a href="index.html">
┬а ┬а ┬а ┬а ┬а ┬а <img id="header-logo" src="image/67.png" alt="р╣Вр╕ер╣Вр╕Бр╣Йр╕гр╕░р╕Ър╕Ъ"> 
┬а ┬а ┬а ┬а </a>
┬а ┬а </div> 
┬а ┬а 
┬а ┬а <ul class="menu">
┬а ┬а ┬а ┬а <li class="menu-item"> 
┬а ┬а ┬а ┬а ┬а ┬а <a href="index.html"><i class="fas fa-home"></i> р╕лр╕Щр╣Йр╕▓р╣Бр╕гр╕Б</a>
┬а ┬а ┬а ┬а </li>
┬а ┬а ┬а ┬а <li class="menu-item"> 
┬а ┬а ┬а ┬а ┬а ┬а <a href="profile.html"><i class="fas fa-user"></i> р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з</a>
┬а ┬а ┬а ┬а </li>
┬а ┬а ┬а ┬а <li class="menu-item">
┬а ┬а ┬а ┬а ┬а ┬а <a href="save.html"><i class="fas fa-file-alt"></i> р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕Бр╕▓р╕гр╕нр╕Ър╕гр╕б</a>
┬а ┬а ┬а ┬а </li>
┬а ┬а ┬а ┬а <li class="menu-item active"> 
┬а ┬а ┬а ┬а ┬а ┬а <a href="reward.html"><i class="fas fa-medal"></i> р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕гр╕▓р╕Зр╕зр╕▒р╕е</a>
┬а ┬а ┬а ┬а </li>
┬а ┬а ┬а ┬а <li class="menu-item">
┬а ┬а ┬а ┬а ┬а ┬а <a href="dashboard.html"><i class="fas fa-chart-bar"></i> р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</a>
┬а ┬а ┬а ┬а </li>
┬а ┬а ┬а ┬а <li class="menu-item">
┬а ┬а ┬а ┬а ┬а ┬а <a href="setting.html"><i class="fas fa-cog"></i> р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓</a>
┬а ┬а ┬а ┬а </li>
┬а ┬а ┬а ┬а <li class="menu-item">
┬а ┬а ┬а ┬а ┬а ┬а <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ</a>
┬а ┬а ┬а ┬а </li>
┬а ┬а </ul>
</div>
┬а ┬а 
<div class="main-content">
┬а ┬а 
┬а ┬а <h1><i class="fas fa-medal"></i> р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕гр╕▓р╕Зр╕зр╕▒р╕е</h1> 

┬а ┬а <div class="profile-container"> 
┬а ┬а ┬а ┬а <form id="rewardForm">
┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а <div class="form-row three-col">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="reward_name">р╕Кр╕╖р╣Ир╕нр╕гр╕▓р╕Зр╕зр╕▒р╕е:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="reward_name" name="reward_name" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Б" class="styled-input">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="organization">р╕лр╕Щр╣Ир╕зр╕вр╕Зр╕▓р╕Щр╕Чр╕╡р╣Ир╕нр╕нр╕Бр╕гр╕▓р╕Зр╕зр╕▒р╕е:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="organization" name="organization" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Б" class="styled-input">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="award_date">р╕Ыр╕гр╕░р╕Бр╕▓р╕и р╕У р╕зр╕▒р╕Щр╕Чр╕╡р╣И:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="award_date" name="award_date" class="styled-date-input">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div class="form-row three-col">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="level_national">р╕гр╕░р╕Фр╕▒р╕Ър╕Кр╕▓р╕Хр╕┤:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="level_national" name="level_national" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Б" class="styled-input">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="level_region">р╕гр╕░р╕Фр╕▒р╕Ър╕ар╕▓р╕Д:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="level_region" name="level_region" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Б" class="styled-input">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="level_province">р╕гр╕░р╕Фр╕▒р╕Ър╕Ир╕▒р╕Зр╕лр╕зр╕▒р╕Ф:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="level_province" name="level_province" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Б" class="styled-input">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div class="form-row two-col">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="level_area">р╕гр╕░р╕Фр╕▒р╕Ър╣Ар╕Вр╕Хр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣И:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="level_area" name="level_area" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Б" class="styled-input">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="level_group">р╕гр╕░р╕Фр╕▒р╕Ър╕Бр╕ер╕╕р╣Ир╕бр╣Вр╕гр╕Зр╣Ар╕гр╕╡р╕вр╕Щ:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="level_group" name="level_group" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Б" class="styled-input">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div class="form-group full-width">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="certificate_url">р╣Бр╕Щр╕Ър╣Ар╕Бр╕╡р╕вр╕гр╕Хр╕┤р╕Ър╕▒р╕Хр╕г:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="file" id="certificate_url" name="certificate_url" class="styled-file-input" accept="image/jpeg,image/png,image/gif">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <small class="file-help-text">р╕гр╕нр╕Зр╕гр╕▒р╕Ър╣Др╕Яр╕ер╣М JPG, PNG, GIF р╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 2MB</small>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а <div class="action-buttons">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button type="button" class="submit-btn submit-btn-green" onclick="submitRewardData()">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е</button>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </form>
┬а ┬а </div>
</div>

<div id="logoutModal" class="modal">
┬а ┬а <div class="modal-content">
┬а ┬а ┬а ┬а <h2 class="modal-title icon-only"><i class="fas fa-exclamation-triangle"></i></h2> 
┬а ┬а ┬а ┬а <h2 class="modal-title-text">р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ</h2>
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а <p>р╕Др╕╕р╕Ур╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ър╕лр╕гр╕╖р╕нр╣Др╕бр╣И?</p>
┬а ┬а ┬а ┬а <div class="modal-actions">
┬а ┬а ┬а ┬а ┬а ┬а <button class="modal-btn cancel-btn-red" onclick="hideLogoutModal()">р╕вр╕Бр╣Ар╕ер╕┤р╕Б</button>
┬а ┬а ┬а ┬а ┬а ┬а <button class="modal-btn confirm-btn-blue" onclick="confirmLogout()">р╕вр╕╖р╕Щр╕вр╕▒р╕Щ</button>
┬а ┬а ┬а ┬а </div>
┬а ┬а </div>
</div>

<script>
// ******************************************************
// 0. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ URL р╕Вр╕нр╕З Google Apps Script Web App
// ******************************************************
// NOTE: р╣Гр╕Кр╣Й URL р╕Вр╕нр╕Зр╕Др╕╕р╕У
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxiPmc9UAIlhpMbna2W6Hm7WhSqnEstcZFFFQ0KIbfNcNuR1yHlS6ZdUVU4UrYKuD7Z/exec';

// ******************************************************
// 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ (Security Check)
// ******************************************************
function checkLoginStatus() {
┬а ┬а const isLoggedIn = localStorage.getItem('isLoggedIn');
┬а ┬а if (isLoggedIn !== 'true') {
┬а ┬а ┬а ┬а window.location.replace('login.html');
┬а ┬а }
}

// ******************************************************
// 3. р╕Бр╕▓р╕гр╕Бр╕│р╕лр╕Щр╕Ф Active State р╕Вр╕нр╕З Sidebar
// ******************************************************
function setActiveMenuItem() {
┬а ┬а const currentPath = window.location.pathname.split('/').pop();
┬а ┬а const menuItems = document.querySelectorAll('.menu-item a');

┬а ┬а menuItems.forEach(link => {
┬а ┬а ┬а ┬а const linkPath = link.getAttribute('href');
┬а ┬а ┬а ┬а if (linkPath === currentPath || (currentPath === '' && linkPath === 'index.html')) {
┬а ┬а ┬а ┬а ┬а ┬а link.closest('.menu-item').classList.add('active');
┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а link.closest('.menu-item').classList.remove('active');
┬а ┬а ┬а ┬а }
┬а ┬а });
}
// ******************************************************
// 4. р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕г Logout Confirmation Modal
// ******************************************************
const logoutModal = document.getElementById('logoutModal');
const logoutButton = document.getElementById('logout-btn');

function showLogoutModal(e) {
┬а ┬а if (e) e.preventDefault();
┬а ┬а if(logoutModal) logoutModal.classList.add('show');
}
function hideLogoutModal() {
┬а ┬а if(logoutModal) logoutModal.classList.remove('show');
}
function confirmLogout() {
┬а ┬а hideLogoutModal();
┬а ┬а localStorage.removeItem('isLoggedIn');
┬а ┬а localStorage.removeItem('userName');
┬а ┬а window.location.replace('login.html');
}

if (logoutButton) {
┬а ┬а logoutButton.addEventListener('click', showLogoutModal);
}
if(logoutModal) {
┬а ┬а logoutModal.addEventListener('click', function(e) {
┬а ┬а ┬а ┬а if (e.target === this) {
┬а ┬а ┬а ┬а ┬а ┬а hideLogoutModal();
┬а ┬а ┬а ┬а }
┬а ┬а });
}

// ******************************************************
// 5. Logic р╕кр╕│р╕лр╕гр╕▒р╕Ъ Form (р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Ы Google Sheet р╣Вр╕Фр╕вр╣Гр╕Кр╣Й Fetch API)
// ******************************************************
/**
┬а* р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕ер╕▒р╕Бр╣Гр╕Щр╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Яр╕нр╕гр╣Мр╕бр╕гр╕▓р╕Зр╕зр╕▒р╕е р╣Вр╕Фр╕вр╕Ир╕░р╕нр╣Ир╕▓р╕Щр╣Др╕Яр╕ер╣М, р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ Base64, 
┬а* р╣Бр╕ер╣Йр╕зр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕гр╕зр╕бр╕Цр╕╢р╕З Base64) р╣Др╕Ыр╕вр╕▒р╕З Apps Script р╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ JSON.
┬а*/
function submitRewardData() {
┬а ┬а // р╕Бр╕│р╕лр╕Щр╕Ф Loading State
┬а ┬а const submitBtn = document.querySelector('.submit-btn');
┬а ┬а const originalText = submitBtn.textContent;
┬а ┬а submitBtn.disabled = true;
┬а ┬а submitBtn.textContent = 'р╕Бр╕│р╕ер╕▒р╕Зр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б...';
┬а ┬а 
┬а ┬а const form = document.getElementById('rewardForm');
┬а ┬а const formData = new FormData(form);
┬а ┬а 
┬а ┬а // 1. р╕гр╕зр╕Ър╕гр╕зр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е Form р╕Чр╕▒р╣Ир╕зр╣Др╕Ы
┬а ┬а const data = {};
┬а ┬а for (const [key, value] of formData.entries()) {
┬а ┬а ┬а ┬а data[key] = value;
┬а ┬а }
┬а ┬а // р╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ
┬а ┬а data.action = 'submitReward'; 
┬а ┬а // р╣Гр╕Кр╣Й ISO String р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╣Ар╕Ыр╣Зр╕Щр╕кр╕▓р╕Бр╕е
┬а ┬а data.timestamp = new Date().toISOString(); 

┬а ┬а const fileInput = document.getElementById('certificate_url');
┬а ┬а const file = fileInput.files[0];

┬а ┬а // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ър╕▒р╕Зр╕Др╕▒р╕Ъ (р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З)
┬а ┬а if (!data.reward_name || !data.organization) {
┬а ┬а ┬а ┬а alert('тЪая╕П р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕гр╕▓р╕Зр╕зр╕▒р╕ер╣Бр╕ер╕░р╕лр╕Щр╣Ир╕зр╕вр╕Зр╕▓р╕Щр╕Чр╕╡р╣Ир╕нр╕нр╕Бр╕гр╕▓р╕Зр╕зр╕▒р╕е');
┬а ┬а ┬а ┬а submitBtn.disabled = false;
┬а ┬а ┬а ┬а submitBtn.textContent = originalText;
┬а ┬а ┬а ┬а return;
┬а ┬а }

┬а ┬а if (!file) {
┬а ┬а ┬а ┬а // р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╣Др╕Яр╕ер╣М р╣Гр╕лр╣Йр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Яр╕нр╕гр╣Мр╕бр╕Чр╕╡р╣Ир╣Ар╕лр╕ер╕╖р╕нр╣Ар╕Ыр╣Зр╕Щ JSON
┬а ┬а ┬а ┬а sendData(data, submitBtn, originalText);
┬а ┬а ┬а ┬а return;
┬а ┬а }

┬а ┬а // 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╕Щр╕▓р╕Фр╣Др╕Яр╕ер╣М (р╕Ир╕│р╕Бр╕▒р╕Фр╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 2MB) р╣Бр╕ер╕░р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╣Др╕Яр╕ер╣М
┬а ┬а const MAX_SIZE = 2 * 1024 * 1024; // 2MB
┬а ┬а const ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/gif'];
┬а ┬а 
┬а ┬а if (file.size > MAX_SIZE) {
┬а ┬а ┬а ┬а alert('тЭМ р╕Вр╕Щр╕▓р╕Фр╣Др╕Яр╕ер╣Мр╣Ар╕Бр╕┤р╕Щ 2MB р╣Вр╕Ыр╕гр╕Фр╣Ар╕ер╕╖р╕нр╕Бр╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Ар╕ер╣Зр╕Бр╕ер╕З');
┬а ┬а ┬а ┬а submitBtn.disabled = false;
┬а ┬а ┬а ┬а submitBtn.textContent = originalText;
┬а ┬а ┬а ┬а return;
┬а ┬а }
┬а ┬а 
┬а ┬а if (!ALLOWED_TYPES.includes(file.type)) {
┬а ┬а ┬а ┬а alert('тЭМ р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╣Др╕Яр╕ер╣Мр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З р╕гр╕нр╕Зр╕гр╕▒р╕Ър╣Ар╕Йр╕Юр╕▓р╕░ JPG, PNG, GIF р╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ');
┬а ┬а ┬а ┬а submitBtn.disabled = false;
┬а ┬а ┬а ┬а submitBtn.textContent = originalText;
┬а ┬а ┬а ┬а return;
┬а ┬а }


┬а ┬а // 3. р╕нр╣Ир╕▓р╕Щр╣Др╕Яр╕ер╣Мр╣Бр╕ер╕░р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ Base64
┬а ┬а const reader = new FileReader();
┬а ┬а 
┬а ┬а reader.onload = function(e) {
┬а ┬а ┬а ┬а const base64 = e.target.result.split(',')[1]; 
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а data.fileName = file.name;
┬а ┬а ┬а ┬а data.fileType = file.type;
┬а ┬а ┬а ┬а data.fileData = base64; 

┬а ┬а ┬а ┬а // 4. р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е JSON р╣Др╕Ыр╕вр╕▒р╕З Apps Script
┬а ┬а ┬а ┬а sendData(data, submitBtn, originalText);
┬а ┬а };
┬а ┬а 
┬а ┬а reader.onerror = function(e) {
┬а ┬а ┬а ┬а alert('тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕нр╣Ир╕▓р╕Щр╣Др╕Яр╕ер╣Мр╣Др╕Фр╣Й');
┬а ┬а ┬а ┬а console.error("File reading error: ", e);
┬а ┬а ┬а ┬а submitBtn.disabled = false;
┬а ┬а ┬а ┬а submitBtn.textContent = originalText;
┬а ┬а };

┬а ┬а reader.readAsDataURL(file);
}

/**
┬а* р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕вр╣Ир╕нр╕вр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е JSON р╣Др╕Ыр╕вр╕▒р╕З Apps Script
┬а* @param {Object} data - р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Яр╕нр╕гр╣Мр╕бр╕Юр╕гр╣Йр╕нр╕б Base64 (р╕Цр╣Йр╕▓р╕бр╕╡р╣Др╕Яр╕ер╣М)
┬а* @param {HTMLElement} submitBtn - р╕Ыр╕╕р╣Ир╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕Цр╕▓р╕Щр╕░
┬а* @param {string} originalText - р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕Фр╕┤р╕бр╕Вр╕нр╕Зр╕Ыр╕╕р╣Ир╕б
┬а*/
function sendData(data, submitBtn, originalText) {
┬а ┬а fetch(WEB_APP_URL, {
┬а ┬а ┬а ┬а method: 'POST',
┬а ┬а ┬а ┬а body: JSON.stringify(data), 
┬а ┬а ┬а ┬а headers: {
┬а ┬а ┬а ┬а ┬а ┬а 'Content-Type': 'application/json' 
┬а ┬а ┬а ┬а }
┬а ┬а })
┬а ┬а .then(response => {
┬а ┬а ┬а ┬а if (!response.ok) {
┬а ┬а ┬а ┬а ┬а ┬а throw new Error(`р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з (HTTP Status: ${response.status}).`);
┬а ┬а ┬а ┬а }
        // ЁЯФС р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣И 1: р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Ир╕▓р╕Б response.json() р╣Ар╕Ыр╣Зр╕Щ response.text()
┬а ┬а ┬а ┬а return response.text(); 
┬а ┬а })
    // ЁЯФС р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣И 2: р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Кр╕╖р╣Ир╕нр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕гр╕▒р╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Ар╕Ыр╣Зр╕Щ resultText
┬а ┬а .then(resultText => { 
┬а ┬а ┬а ┬а console.log('Server response:', resultText);
┬а ┬а ┬а ┬а 
        // ЁЯФС р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣И 3: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Ир╕▓р╕Б Plain Text 'success'
┬а ┬а ┬а ┬а if (resultText.trim() === 'success') {
┬а ┬а ┬а ┬а ┬а ┬а alert('тЬЕ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╕░р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╣Ар╕Бр╕╡р╕вр╕гр╕Хр╕┤р╕Ър╕▒р╕Хр╕гр╕кр╕│р╣Ар╕гр╣Зр╕И!');
            // ЁЯФС р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣И 4: р╣Гр╕Кр╣Й URL р╣Ар╕Хр╣Зр╕бр╕Вр╕нр╕З GitHub Pages р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕лр╕Щр╣Йр╕▓р╣Др╕Фр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
┬а ┬а ┬а ┬а ┬а ┬а window.location.href = 'https://noxarthhh.github.io/my-google-sheet-app/success.html'; 
┬а ┬а ┬а ┬а } else {
            // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б Error р╕Ир╕▓р╕Б Apps Script
┬а ┬а ┬а ┬а ┬а ┬а alert('тЭМ р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ер╣Йр╕бр╣Ар╕лр╕ер╕з: ' + resultText);
┬а ┬а ┬а ┬а }
┬а ┬а })
┬а ┬а .catch(error => {
┬а ┬а ┬а ┬а console.error('Fetch Error:', error);
┬а ┬а ┬а ┬а alert(`ЁЯЪи р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е: ${error.message} \n\nр╣Вр╕Ыр╕гр╕Фр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Apps Script Deployment`);
┬а ┬а })
┬а ┬а .finally(() => {
┬а ┬а ┬а ┬а // р╕Др╕╖р╕Щр╕Др╣Ир╕▓ state р╕Вр╕нр╕Зр╕Ыр╕╕р╣Ир╕б
┬а ┬а ┬а ┬а submitBtn.disabled = false;
┬а ┬а ┬а ┬а submitBtn.textContent = originalText;
┬а ┬а });
}


// ******************************************************
// 6. INITIALIZATION (р╣Ар╕бр╕╖р╣Ир╕нр╕лр╕Щр╣Йр╕▓р╣Вр╕лр╕ер╕Фр╣Ар╕кр╕гр╣Зр╕И)
// ******************************************************
document.addEventListener('DOMContentLoaded', () => {
┬а ┬а checkLoginStatus();
┬а ┬а setActiveMenuItem();
});
</script>
</body>
</html>