<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</title>
    <link rel="stylesheet" href="reward.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <script>
        // NOTE: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Dark Mode ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ô <head>
        function toggleTheme(theme) {
            const body = document.body;
            body.classList.remove('light-mode', 'dark-mode'); 
            if (theme === 'dark') {
                body.classList.add('dark-mode');
            }
        }
        function loadTheme() {
            // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô localStorage
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const defaultTheme = prefersDark ? 'dark' : 'light';
            const savedTheme = localStorage.getItem('theme') || defaultTheme; 
            toggleTheme(savedTheme);
        }
        loadTheme(); 
    </script>
</head>
<body>

<div class="sidebar">
    <div class="logo">
        <a href="index.html">
            <img id="header-logo" src="image/67.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡∏∞‡∏ö‡∏ö"> 
        </a>
    </div> 
    
    <ul class="menu">
        <li class="menu-item"> 
            <a href="index.html"><i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
        </li>
        <li class="menu-item"> 
            <a href="profile.html"><i class="fas fa-user"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
        </li>
        <li class="menu-item">
            <a href="save.html"><i class="fas fa-file-alt"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</a>
        </li>
        <li class="menu-item active"> 
            <a href="reward.html"><i class="fas fa-medal"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</a>
        </li>
        <li class="menu-item">
            <a href="dashboard.html"><i class="fas fa-chart-bar"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a>
        </li>
        <li class="menu-item">
            <a href="setting.html"><i class="fas fa-cog"></i> ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
        </li>
        <li class="menu-item">
            <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        </li>
    </ul>
</div>
    
<div class="main-content">
    
    <h1><i class="fas fa-medal"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h1> 

    <div class="profile-container"> 
        <form id="rewardForm">
            
            <div class="form-row three-col">
                <div class="form-group">
                    <label for="reward_name">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:</label>
                    <input type="text" id="reward_name" name="reward_name" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å" class="styled-input">
                </div>

                <div class="form-group">
                    <label for="organization">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:</label>
                    <input type="text" id="organization" name="organization" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å" class="styled-input">
                </div>

                <div class="form-group">
                    <label for="award_date">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="date" id="award_date" name="award_date" class="styled-date-input">
                </div>
            </div>

            <div class="form-row three-col">
                <div class="form-group">
                    <label for="level_national">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏≤‡∏ï‡∏¥:</label>
                    <input type="text" id="level_national" name="level_national" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å" class="styled-input">
                </div>

                <div class="form-group">
                    <label for="level_region">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏†‡∏≤‡∏Ñ:</label>
                    <input type="text" id="level_region" name="level_region" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å" class="styled-input">
                </div>

                <div class="form-group">
                    <label for="level_province">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</label>
                    <input type="text" id="level_province" name="level_province" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å" class="styled-input">
                </div>
            </div>

            <div class="form-row two-col">
                <div class="form-group">
                    <label for="level_area">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="text" id="level_area" name="level_area" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å" class="styled-input">
                </div>

                <div class="form-group">
                    <label for="level_group">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
                    <input type="text" id="level_group" name="level_group" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å" class="styled-input">
                </div>
            </div>

            <div class="form-group full-width">
                <label for="certificate_url">‡πÅ‡∏ô‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£:</label>
                <input type="file" id="certificate_url" name="certificate_url" class="styled-file-input" accept="image/jpeg,image/png,image/gif">
                <small class="file-help-text">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG, GIF ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2MB</small>
            </div>
            
            <div class="action-buttons">
                <button type="button" class="submit-btn submit-btn-green" onclick="submitRewardData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </form>
    </div>
</div>

<div id="logoutModal" class="modal">
    <div class="modal-content">
        <h2 class="modal-title icon-only"><i class="fas fa-exclamation-triangle"></i></h2> 
        <h2 class="modal-title-text">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h2>
        
        <p>‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
        <div class="modal-actions">
            <button class="modal-btn cancel-btn-red" onclick="hideLogoutModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="modal-btn confirm-btn-blue" onclick="confirmLogout()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </div>
    </div>
</div>

<script>
// ******************************************************
// 0. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App
// ******************************************************
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwdJKqG0kUFgAJ13OiWfkCCen0XEFVpivgbBoRhiFPm7b2ofO0VdKwAoQnkAMVAz-ft/exec';

// ******************************************************
// 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Security Check)
// ******************************************************
function checkLoginStatus() {
    const isLoggedIn = localStorage.getItem('isLoggedIn');
    if (isLoggedIn !== 'true') {
        window.location.replace('login.html');
    }
}

// ******************************************************
// 3. ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Active State ‡∏Ç‡∏≠‡∏á Sidebar
// ******************************************************
function setActiveMenuItem() {
    const currentPath = window.location.pathname.split('/').pop();
    const menuItems = document.querySelectorAll('.menu-item a');

    menuItems.forEach(link => {
        const linkPath = link.getAttribute('href');
        if (linkPath === currentPath || (currentPath === '' && linkPath === 'index.html')) {
            link.closest('.menu-item').classList.add('active');
        } else {
            link.closest('.menu-item').classList.remove('active');
        }
    });
}
// ******************************************************
// 4. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Logout Confirmation Modal
// ******************************************************
const logoutModal = document.getElementById('logoutModal');
const logoutButton = document.getElementById('logout-btn');

function showLogoutModal(e) {
    if (e) e.preventDefault();
    if(logoutModal) logoutModal.classList.add('show');
}
function hideLogoutModal() {
    if(logoutModal) logoutModal.classList.remove('show');
}
function confirmLogout() {
    hideLogoutModal();
    localStorage.removeItem('isLoggedIn');
    localStorage.removeItem('userName');
    window.location.replace('login.html');
}

if (logoutButton) {
    logoutButton.addEventListener('click', showLogoutModal);
}
if(logoutModal) {
    logoutModal.addEventListener('click', function(e) {
        if (e.target === this) {
            hideLogoutModal();
        }
    });
}

// ******************************************************
// 5. Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Form (‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheet ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Fetch API)
// ******************************************************
/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå, ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Base64, 
 * ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á Base64) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Apps Script ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON.
 */
function submitRewardData() {
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Loading State
    const submitBtn = document.querySelector('.submit-btn');
    const originalText = submitBtn.textContent;
    submitBtn.disabled = true;
    submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
    
    const form = document.getElementById('rewardForm');
    const formData = new FormData(form);
    
    // 1. ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Form ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
    const data = {};
    for (const [key, value] of formData.entries()) {
        data[key] = value;
    }
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
    data.action = 'submitReward'; 
    // ‡πÉ‡∏ä‡πâ ISO String ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏Å‡∏•
    data.timestamp = new Date().toISOString(); 

    const fileInput = document.getElementById('certificate_url');
    const file = fileInput.files[0];

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)
    if (!data.reward_name || !data.organization) {
        alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        return;
    }

    if (!file) {
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô JSON
        sendData(data, submitBtn, originalText);
        return;
    }

    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2MB) ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå
    const MAX_SIZE = 2 * 1024 * 1024; // 2MB
    const ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/gif'];
    
    if (file.size > MAX_SIZE) {
        alert('‚ùå ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏¥‡∏ô 2MB ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        return;
    }
    
    if (!ALLOWED_TYPES.includes(file.type)) {
        alert('‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ JPG, PNG, GIF ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        return;
    }


    // 3. ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Base64
    const reader = new FileReader();
    
    reader.onload = function(e) {
        const base64 = e.target.result.split(',')[1]; 
        
        data.fileName = file.name;
        data.fileType = file.type;
        data.fileData = base64; 

        // 4. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Apps Script
        sendData(data, submitBtn, originalText);
    };
    
    reader.onerror = function(e) {
        alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ');
        console.error("File reading error: ", e);
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
    };

    reader.readAsDataURL(file);
}

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πà‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Apps Script
 * @param {Object} data - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° Base64 (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå)
 * @param {HTMLElement} submitBtn - ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
 * @param {string} originalText - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°
 */
function sendData(data, submitBtn, originalText) {
    fetch(WEB_APP_URL, {
        method: 'POST',
        body: JSON.stringify(data), 
        headers: {
            'Content-Type': 'application/json' 
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (HTTP Status: ${response.status}).`);
        }
        return response.json();
    })
    .then(result => {
        console.log('Server response:', result);
        
        if (result && result.result === 'success') {
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ success.html ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            window.location.href = 'success.html';
        } else {
            alert('‚ùå ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + (result ? result.message : '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'));
        }
    })
    .catch(error => {
        console.error('Fetch Error:', error);
        alert(`üö® ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message} \n\n‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Apps Script Deployment`);
    })
    .finally(() => {
        // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ state ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
    });
}


// ******************************************************
// 6. INITIALIZATION (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à)
// ******************************************************
document.addEventListener('DOMContentLoaded', () => {
    checkLoginStatus();
    setActiveMenuItem();
});
</script>
</body>
</html>