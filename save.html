<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</title>
    <link rel="stylesheet" href="save.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
<body>

<div class="sidebar">
    <div class="logo">
        <a href="index.html"><img id="header-logo" src="image/67.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡∏∞‡∏ö‡∏ö"></a>
    </div> 
    <ul class="menu">
        <li class="menu-item"><a href="index.html"><i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
        <li class="menu-item"><a href="profile.html"><i class="fas fa-user"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a></li>
        <li class="menu-item active"><a href="save.html"><i class="fas fa-file-alt"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</a></li>
        <li class="menu-item"><a href="reward.html"><i class="fas fa-medal"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</a></li>
        <li class="menu-item"><a href="dashboard.html"><i class="fas fa-chart-bar"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a></li>
        <li class="menu-item"><a href="setting.html"><i class="fas fa-cog"></i> ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a></li>
        <li class="menu-item"><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></li>
    </ul>
</div>
    
<div class="main-content">
    <h1><i class="fas fa-file-alt"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</h1>
    
    <div class="profile-container">
        <form id="trainingForm"> 
            
            <div class="form-group">
                <label for="course-name">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£:</label>
                <input type="text" id="course-name" name="course_name" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£" class="styled-input" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="start-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏°:</label>
                    <input type="date" id="start-date" name="date_start" class="styled-input styled-date-input" required>
                </div>
                <div class="form-group">
                    <label for="end-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°:</label>
                    <input type="date" id="end-date" name="date_end" class="styled-input styled-date-input" required>
                </div>
                <div class="form-group">
                    <label for="hours">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á:</label>
                    <input type="number" id="hours" name="hours" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á" class="styled-input" required>
                </div>
            </div>

            <div class="form-group">
                <label for="organizer">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏≠‡∏ö‡∏£‡∏°:</label>
                <input type="text" id="organizer" name="organizer" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏≠‡∏ö‡∏£‡∏°" class="styled-input" required>
            </div>

            <div class="form-group">
                <label for="report-summary">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏° (‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç):</label>
                <textarea id="report-summary" name="summary" rows="4" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠" class="styled-input"></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="benefit-self">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ï‡πà‡∏≠‡∏ï‡∏ô‡πÄ‡∏≠‡∏á:</label>
                    <input type="text" id="benefit-self" name="benefit_self" placeholder="‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ï‡πà‡∏≠‡∏ï‡∏ô‡πÄ‡∏≠‡∏á" class="styled-input">
                </div>
                <div class="form-group">
                    <label for="benefit-org">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ï‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£:</label>
                    <input type="text" id="benefit-org" name="benefit_org" placeholder="‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ï‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£" class="styled-input">
                </div>
                <div class="form-group">
                    <label for="benefit-student">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ï‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
                    <input type="text" id="benefit-student" name="benefit_student" placeholder="‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ï‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="styled-input">
                </div>
            </div>

            <div class="form-group">
                <label for="certificate-file">‡πÅ‡∏ô‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ (‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°):</label>
                <input type="file" id="certificate-file" name="certificate_file" class="styled-file-input" accept="image/jpeg, image/png, application/pdf"> 
                <small class="file-help-text">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG, PDF ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2MB</small>
            </div>
        
            <div class="action-buttons">
                <button type="button" class="submit-btn" id="saveBtn" onclick="submitTrainingData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </form>
    </div>
</div>

<div id="logoutModal" class="modal">
     <div class="modal-content">
          <h2 class="modal-title icon-only"><i class="fas fa-exclamation-triangle"></i></h2> 
          <h2 class="modal-title-text">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h2>
          <p>‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
          <div class="modal-actions">
                <button class="modal-btn cancel-btn-red" onclick="hideLogoutModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="modal-btn confirm-btn-blue" onclick="confirmLogout()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
          </div>
     </div>
</div>

<script>
// ******************************************************
// 0. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL (üî¥ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà Deploy ‡πÉ‡∏´‡∏°‡πà üî¥)
// ******************************************************
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwdJKqG0kUFgAJ13OiWfkCCen0XEFVpivgbBoRhiFPm7b2ofO0VdKwAoQnkAMVAz-ft/exec';

// 1. Security Check
function checkLoginStatus() {
    const isLoggedIn = localStorage.getItem('isLoggedIn');
    if (isLoggedIn !== 'true') window.location.replace('login.html');
}

// 2. Active Menu
function setActiveMenuItem() {
    const currentPath = window.location.pathname.split('/').pop();
    const menuItems = document.querySelectorAll('.menu-item a');
    menuItems.forEach(link => {
        const linkPath = link.getAttribute('href');
        if (linkPath === currentPath || (currentPath === '' && linkPath === 'index.html')) {
            link.closest('.menu-item').classList.add('active');
        } else {
            link.closest('.menu-item').classList.remove('active');
        }
    });
}

// 3. Logout Modal
const logoutModal = document.getElementById('logoutModal');
const logoutButton = document.getElementById('logout-btn');
function showLogoutModal(e) { if (e) e.preventDefault(); if(logoutModal) logoutModal.classList.add('show'); }
function hideLogoutModal() { if(logoutModal) logoutModal.classList.remove('show'); }
function confirmLogout() {
    hideLogoutModal();
    localStorage.removeItem('isLoggedIn');
    localStorage.removeItem('userName');
    window.location.replace('login.html');
}
if (logoutButton) logoutButton.addEventListener('click', showLogoutModal);
if (logoutModal) logoutModal.addEventListener('click', function(e) { if (e.target === this) hideLogoutModal(); });


// ******************************************************
// 4. Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Form (‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö Form Data URLSearchParams)
// ******************************************************
function submitTrainingData() {
    const submitBtn = document.getElementById('saveBtn');
    const originalText = submitBtn.textContent;
    const form = document.getElementById('trainingForm');
    
    if (!form.checkValidity()) {
         alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
         form.reportValidity();
         return;
    }

    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
    
    const data = new URLSearchParams();
    data.append('action', 'saveTraining'); 
    data.append('timestamp', new Date().toLocaleString('th-TH'));

    const formData = new FormData(form);
    for (const [key, value] of formData.entries()) {
        if (key !== 'certificate_file') {
            data.append(key, value);
        }
    }

    const fileInput = document.getElementById('certificate-file');
    const file = fileInput.files[0];

    if (file) {
        if (file.size > 2 * 1024 * 1024) {
            alert('‚ùå ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏¥‡∏ô 2MB');
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const base64 = e.target.result.split(',')[1];
            data.append('fileName', file.name);
            data.append('mimeType', file.type);
            data.append('fileData', base64);
            sendToGoogleScript(data, submitBtn, originalText);
        };
        reader.onerror = function() {
            alert('‚ùå ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
        };
        reader.readAsDataURL(file);
    } else {
        sendToGoogleScript(data, submitBtn, originalText);
    }
}

function sendToGoogleScript(data, submitBtn, originalText) {
    fetch(WEB_APP_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: data 
    })
    .then(response => response.json())
    .then(result => {
        if (result.result === 'success') {
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            document.getElementById('trainingForm').reset();
        } else {
            alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('üö® ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + error.message);
    })
    .finally(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
    });
}

// 5. Theme Settings (‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î ‡∏Å‡∏±‡∏ô Error)
function toggleTheme(theme) {
    const body = document.body;
    body.classList.remove('light-mode', 'dark-mode'); 
    if (theme === 'dark') body.classList.add('dark-mode');
}
function loadTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light'; 
    toggleTheme(savedTheme);
}

// 6. Initial Load
document.addEventListener('DOMContentLoaded', function() {
    checkLoginStatus(); 
    setActiveMenuItem();
    loadTheme(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Theme ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤
});
</script>
</body>
</html>